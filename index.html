<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8">
  <title>QR Skenuoklis</title>
  <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #f9f9f9; }
    #reader { width: 300px; margin: auto; }
    #success {
      display: none;
      font-size: 50px;
      color: green;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>QR Skenuoklis</h1>
  <div id="reader"></div>

  <div id="success">✔️</div>

  <h3>Nuskenuoti ID:</h3>
  <ul id="scans"></ul>
  <button onclick="downloadFile()">Atsisiųsti ID failą</button>

  <!-- Pypsėjimo garsas -->
  <audio id="beep" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

  <script>
    let ids = [];

    function onScanSuccess(decodedText) {
      if (!ids.includes(decodedText)) {
        ids.push(decodedText);

        // į sąrašą ekrane
        let li = document.createElement("li");
        li.textContent = decodedText;
        document.getElementById("scans").appendChild(li);

        // Pypsėjimas
        document.getElementById("beep").play();

        // Varnelė trumpam
        let success = document.getElementById("success");
        success.style.display = "block";
        setTimeout(() => success.style.display = "none", 1000);
      }
    }

    function downloadFile() {
      let blob = new Blob([ids.join("\\n")], { type: "text/plain" });
      let link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "nuskenuoti_id.txt";
      link.click();
    }

    // Čia vietoj Html5QrcodeScanner naudojam tiesioginį kameros paleidimą
    function startScanner() {
      let html5QrCode = new Html5Qrcode("reader");
      Html5Qrcode.getCameras().then(cameras => {
        if (cameras && cameras.length) {
          let cameraId = cameras[0].id;
          html5QrCode.start(
            cameraId,
            { fps: 10, qrbox: 250 },
            onScanSuccess
          ).catch(err => console.error("Klaida paleidžiant kamerą:", err));
        }
      }).catch(err => console.error("Kamerų sąrašo klaida:", err));
    }

    startScanner();
  </script>
</body>
</html>
