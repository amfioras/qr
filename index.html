<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8">
  <title>QR Skenuoklis</title>
  <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #f9f9f9; }
    #reader { width: 300px; margin: auto; display: none; }
    #success {
      display: none;
      font-size: 50px;
      color: green;
      margin-top: 20px;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <h1>QR Skenuoklis</h1>

  <button onclick="startScanner()">üì∑ Skenuoti</button>
  <div id="reader"></div>

  <div id="success">‚úîÔ∏è</div>

  <h3>Nuskenuoti ID:</h3>
  <ul id="scans"></ul>
  <button onclick="downloadFile()">Atsisi≈≥sti ID failƒÖ</button>

  <!-- Pypsƒójimo garsas -->
  <audio id="beep" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

  <script>
    let ids = [];
    let html5QrCode;

    function onScanSuccess(decodedText) {
      if (!ids.includes(decodedText)) {
        ids.push(decodedText);

        // ƒØ sƒÖra≈°ƒÖ ekrane
        let li = document.createElement("li");
        li.textContent = decodedText;
        document.getElementById("scans").appendChild(li);

        // Pypsƒójimas
        document.getElementById("beep").play();

        // Varnelƒó trumpam
        let success = document.getElementById("success");
        success.style.display = "block";
        setTimeout(() => success.style.display = "none", 1000);
      }
    }

    function downloadFile() {
      let blob = new Blob([ids.join("\\n")], { type: "text/plain" });
      let link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "nuskenuoti_id.txt";
      link.click();
    }

    function startScanner() {
      document.getElementById("reader").style.display = "block";
      html5QrCode = new Html5Qrcode("reader");

      Html5Qrcode.getCameras().then(cameras => {
        if (cameras && cameras.length) {
          let cameraId = cameras[0].id; // naudoja pirmƒÖ rastƒÖ kamerƒÖ
          html5QrCode.start(
            cameraId,
            { fps: 10, qrbox: 250 },
            onScanSuccess
          ).catch(err => console.error("Klaida paleid≈æiant kamerƒÖ:", err));
        }
      }).catch(err => console.error("Kamer≈≥ sƒÖra≈°o klaida:", err));
    }
  </script>
</body>
</html>
